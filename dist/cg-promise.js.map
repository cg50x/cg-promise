{"version":3,"file":"cg-promise.js","sources":["../cg-promise.ts"],"sourcesContent":["enum Status {\n  Rejected,\n  Resolved,\n  Pending\n};\n\nexport default class CGPromise {\n  private status = Status.Pending;\n  private payload = null;\n  private thenCallbacks = [];\n  private errCallbacks = [];\n\n  public static resolve: any;\n  public static reject: any;\n  public static all: any;\n\n  constructor(cb) {\n    setTimeout(() => {\n      cb(val => this.resolve(val), err => this.reject(err));\n    });\n  }\n  \n  then(cb) {\n    // resolve with the value immediately\n    // or add it to a list of callbacks which will get called later\n    if (this.status === Status.Resolved) {\n      return new CGPromise((resolve, reject) => {\n        const thenCb = this.getAction(resolve, reject, cb);\n        thenCb(this.payload);\n      });\n    } else if (this.status === Status.Rejected) {\n      return new CGPromise((resolve, reject) => {\n        reject(this.payload);\n      });\n    } else {\n      return new CGPromise((resolve, reject) => {\n        const thenCb = this.getAction(resolve, reject, cb);\n        this.thenCallbacks.push(thenCb);\n        this.errCallbacks.push(() => {\n          reject(this.payload);\n        });\n      });\n    }\n  }\n\n  catch(cb) {\n    // resolve with the value immediately\n    // or add it to a list of callbacks which will get called later\n    if (this.status === Status.Rejected) {\n      return new CGPromise((resolve, reject) => {\n        const errCb = this.getAction(resolve, reject, cb);\n        errCb(this.payload);\n      });\n    } else if (this.status === Status.Resolved) {\n      return new CGPromise((resolve) => {\n        resolve(this.payload);\n      });\n    } else {\n      return new CGPromise((resolve, reject) => {\n        const errCb = this.getAction(resolve, reject, cb);\n        this.errCallbacks.push(errCb);\n        this.thenCallbacks.push(() => {\n          resolve(this.payload);\n        });\n      });\n    }\n  }\n\n  private reject(err) {\n    if (this.status !== Status.Pending) {\n      return;\n    }\n    this.status = Status.Rejected;\n    this.payload = err;\n    this.errCallbacks.forEach((cb) => {\n      cb(this.payload);\n    });\n  }\n\n  private resolve(val) {\n    if (this.status !== Status.Pending) {\n      return;\n    }\n    this.status = Status.Resolved;\n    this.payload = val;\n    this.thenCallbacks.forEach((cb) => {\n      cb(this.payload);\n    });\n  }\n  \n  private getAction(resolve, reject, cb) {\n    return (newPayload) => {\n      try {\n        const result = cb(newPayload);\n        if (result instanceof CGPromise) {\n          result.then(resolve);\n          result.catch(reject);\n        } else {\n          resolve(result);\n        }\n      } catch (err) {\n        reject(err);\n      }\n    };\n  }\n}\n\nCGPromise.resolve = function (value) {\n  return new CGPromise(function (resolve) {\n    resolve(value);\n  });\n};\n\nCGPromise.reject = function (error) {\n  return new CGPromise(function (resolve, reject) {\n    reject(error);\n  });\n};\n\nCGPromise.all = function (promises) {\n  promises = promises || [];\n  return new CGPromise(function (resolve, reject) {\n    // Waiting until all results to complete\n    var results = new Array(promises.length);\n    var numComplete = 0;\n    promises.forEach((promise, index) => {\n      promise.then((val) => {\n        results[index] = val;\n        numComplete += 1;\n        if (numComplete === promises.length) {\n          resolve(results);\n        }\n      });\n    });\n    // If any of them error out, reject the promise.\n    promises.forEach((promise) => {\n      promise.catch(function (err) {\n        reject(err);\n      });\n    });\n  });\n};\n"],"names":[],"mappings":"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"}